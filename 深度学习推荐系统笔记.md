[toc]



# 1. 互联网的增长引擎 -- 推荐系统

## 1.1 为什么推荐系统时互联网的增长引擎

*   广告1%的点击率增长，就能为公司带来上千万利润。

### 1.1.1 推荐系统的作用和意义--终极优化目标包括两个维度

1.   用户角度
     *   用户痛点：互联网带来海量信息，推荐系统需要通过利用各类历史信息，帮助用户高效获得感兴趣的信息。
2.   公司角度
     *   推荐系统最大限度的提高目标指标，从而达到公司商业目标连续增长目的。

### 1.1.2 推荐系统与youtube的观看时长

*   1.1.1中的两个维度应该是和谐统一的，比如最大user generated content平台youtube的收入来源为广告，而优化用户的体验结果可以在用户观看时长上直接体现。用户观看时长与广告总曝光机会成正比，而已两个维度在“观看时长”上达成一致。

### 1.1.3 推荐系统与电商平台的收入增长

*   推荐系统在电商平台上直接驱动公司收入的增长，推荐质量直接影响购买转化率cvr。
*   天猫平台使用“千人千面”推荐系统实现首页所有元素个性化，一切都是由提高转化率ctc，点击率ctr作为核心推荐算法驱动。
*   

## 1.2 推荐系统的架构

*   推荐系统需要处理“人”和“信息”的关系，从而节约1.1.1中的“用户痛点”。
    *   “人”相关的信息可指历史行为，人口属性，关系网络等，统称为**“用户信息”**。
    *   信息不同平台可指“商品信息”，“视频信息”，“新闻信息”等，统称**“物品信息”**。
    *   用户在推荐系统场景下的最终选择受时间，地点，用户状态等环境信息影响，可称为**“场景信息”**或“上下文信息”。

### 1.2.1 推荐系统的逻辑框架

*   推荐系统处理的问题可定义为：对于用户U (user)，在特定场景C (context)下，针对海量的“物品信息”，构建一个函数f(U,I,C)，预测用户对特定候选物品I (item)的喜好程度，并根据喜好程度排序，生成推荐列表的问题。

    <img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h14r3f6r1rj21qu0o2gop.jpg" alt="20210430001007441" style="zoom:30%;" />

### 1.2.2 推荐系统的技术架构

*   在1.2.1的基础上，工程师要着中解决两个问题：

    1.   数据和信息相关问题，即“用户信息”，“物品信息”，“场景信息”分别是什么，如何储存，更新和处理。

         *   数据离线批处理，实时流处理的数据流框架。

    2.   推荐系统算法和模型相关问题，推荐系统如何训练，预测并达到更好的推荐效果。

         *   训练training，评估evaluation，部署deployment，线上推断online inference。

             <img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h14rc5amzsj20r20vf0vl.jpg" alt="v2-b894ffb412a97f719917d1c7a4bea536_1440w" style="zoom: 67%;" />

### 1.2.3 推荐系统的数据部分

*   加工原始数据信息，数据出口主要有三个：
    1.   生成推荐系统所需样本数据，用于算法模型训练和评估
    2.   生成推荐模型服务（model serving）所需的“特征”，用于推荐系统线上推断。
    3.   生成监控系统，商业智能（Business Intelligence）系统所需的统计型数据。

### 1.2.4 推荐系统的模型部分

*   在线环境的模型服务过程
    *   **召回层**：高效的召回规则，算法或简单模型快速从海量选集中召回用户可能感兴趣的物品
    *   **排序层**：排序模型对召回的候选集精排序。
    *   **补充策略与算法层**：也称为“再排序层”，为兼顾“多样性”，“流行度”，“新鲜度”等指标，结合补充策略和算法对推荐列表进行一定调整后，形成用户可见推荐列表。
    *   这个过程一般称为。
*   模型训练确定模型
    *   离线训练和在线更新
        *   **离线训练**：可以利用全量样本和特征，使模型逼近全局最优点。
        *   **在线更新**：准实时地“消化”新的数据样本，更快的反应出数据的变化趋势，满足模型事实性的需求。
*   评估
    *   离线评估和在线A/B测试

### 1.2.5 深度学习对推荐系统的革命性贡献

*   对比传统推荐模型，深度学习模型对数据模式的你和能力和特征组合的挖掘能力更强，模型结构灵活，调整模型结构使其与特定业务数据完美契合。

# 2 前深度学习时代--推荐系统的进化之路

## 2.5 从FM到FFM -- 自动特征较差解决方案

### 辛普森悖论

*   A主体两组样本或更多分组样本中比较结果都好于B主体，但A主体的综合结果却不如B主体。
*   举例：主体为商品A和B
    *   30岁以下用户：商品A，有100个人浏览，40个人点击，点击率40%。商品B，有20个人浏览，10个人点击，点击率50%。B点击率高于A。
    *   30岁或30岁以上用户：商品A，有50个人浏览，10个人点击，点击率20%。商品B，有180个人浏览，54个人点击，点击率30%，B点击率高于A。
    *   综合比较：商品A，有150个人浏览，50个点击，点击率33.33%。商品B，有200个人浏览，64个人点击，点击率32%，A点击率高于B。
*   综合比较时，年龄特征没有使用，逻辑回归只对单一特征item id做加权，不具备特征较差产生高维组合特征能力，表达能力差。

### 2.5.1 POLY2模型 -- 特征交叉的开始

*   暴力组合特征

*   公式

    >   $\large \boxed {\emptyset POLY2(w,x)=\sum_{j_1 = 1}^{n-1}\sum_{j_2 = j_1+1}^{n}w_{h(j_1,j_2)}x_{j_1}x_{j_2}}$

*   线性模型，对所有特征进行两两交叉并对所有组合赋予权重$w_{h(j_1,j_2)}$

*   缺陷:

    1.   经常采用==one-hot==，无筛选特征交叉导致稀疏数据变得更加稀疏，缺乏有效数据导致无法收敛。
    2.   权重参数量由$n$升为$n^2$。

### 2.5.2 FM模形 -- 隐向量特征交叉

*   两个向量的内积$(w_{j_1}.w{j_2})$作为交叉特征的权重，取代了POLY2里的单一权重系数$w_{h(j_1,j_2)}$，使每个特征学习一个隐权重向量latent vector。权重参数量从$n^2$减少到$nk$（k为隐向量维度,$n\gg k$)，因为POLY2中每个特征组合都有一个权重参数，而FM中n个特征只有n个权重参数，特征组合的参数为两个特征权重的内积。

*   公式

    >   $\large \boxed {\emptyset FM(w,x)=\sum_{j_1 = 1}^{n-1}\sum_{j_2 = j_1+1}^{n}(w_{j_1}.w_{j_2})x_{j_1}x_{j_2}}$

*   将矩阵分解隐向量思想扩展，从单纯的用户，物品隐向量扩展到所有特征上。

*   对比POLY2的好处：

    1.   减少参数量，梯度下降训练时复杂度同样降低到nk
    2.   解决数据稀疏性的问题，每个特征的隐向量可以根据其与不同特征的组合进行更新。而POLY2中，只有两个特征同时出现在一个像本中，其权重才可以更新。
    3.   泛化能力强，对于从未出现的特征组合，通过之前学习到的两个特征的隐向量，有计算特征组合权重的能力。

### 2.5.3 FFM模型 -- 引入特征域的概念

*   引入特征域感知（field-aware）概念

*   公式

    >   $\large \boxed {\emptyset FM(w,x)=\sum_{j_1 = 1}^{n-1}\sum_{j_2 = j_1+1}^{n}(w_{j_1,f_2}.w_{j_2,f_1})x_{j_1}x_{j_2}}$

    

# 3.深度学习再推荐系统中的应用

## 3.1深度学习推荐模型演化关系图

*   以多层感知机MLP为核心：

    >![截屏2022-05-15 17.54.33](https://tva1.sinaimg.cn/large/e6c9d24ely1h298ndx37fj20qa0o8q61.jpg)

    *   改变神经网络复杂度
    *   改变特征交叉方式（PNN）
    *   组合模型 （Wide&Deep，Deep&Cross，DeepFM）
    *   FM模型的深度学习演变版本
    *   注意力机制与推荐模型的结合（DIN）
    *   序列模型与推荐模型结合（DIEN）
    *   强化学习与推荐模型结合（DRN）

## 3.2 AutoRec – 单隐层神经网络推荐模型

*   自编码器（AutoEncoder）的思想和协同过滤结合，提出单隐层神经网络推荐模型。

### 3.2.1 AutoRec – 模型的基本原理



##3.6 Wide & Deep模型 – 记忆能力和泛化能力的综合

混合模型：由单层wide部分（提供记忆能力）和多层deep部分（提供泛化能力）组成。兼具逻辑回归和深度神经网络的优点。

### 3.6.1模型的记忆里与泛化能力

>   记忆能力：模型直接学习并利用历史数据中物品或者特征的“共现频率”的能力。记住历史数据的分布特点并利用这些记忆去推荐。
>
>   泛化能力：模型传递特征的相关性以及发觉稀疏甚至从未出现过的稀有特征与最终标签相关性的能力。

### 3.6.2 Wide & Deep模型的结构

><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1eck3j22bj20x80egac1.jpg" alt="截屏2022-04-19 00.36.26" style="zoom:50%;" />

*   wide层：善于处理大量稀疏id类特征

*   Deep层： embedding层+多隐层，利用神经网络进行深层特征交叉，挖掘数据模式。

*   输出层：利用逻辑回归将wide与deep连接形成统一的模型。

    >   ​	![截屏2022-04-19 00.43.08](https://tva1.sinaimg.cn/large/e6c9d24ely1h1ecq6sf50j20xq0h2acr.jpg)

*   交差积变换（Cross product transformation）函数

    >   $\large \boxed {\emptyset_k(X) = \sum_{i=1}^dx_i^{c_ki}   \space\space\space\space\space\space\space\space       c_{ki} \in{0,1}}$

    *   当第i个特征属于第k个组合是，$c_ki=1$。e.g. 特征组合 AND(已安装应用=netflix, 曝光应用=pandora)，只有当两个特征的值与特征组合中的值完全相等，对应的交叉积变换层的结果为1，否则为0.

### 3.6.3 Wide&Deep模型的进化 ——Deep&Cross模型 （DCN）

![截屏2022-05-15 16.43.07](https://tva1.sinaimg.cn/large/e6c9d24ely1h296l25xbgj20u00uajvz.jpg)

*   Cross网络目的：增加特征之间交互力度，通过多层较差层对input进行特征交叉.

    >   $\large\boxed{x_{l+1}=x_ox_l^TW_l+b_l+x_l}$

*   交叉层操作

    >![截屏2022-05-15 17.19.05](https://tva1.sinaimg.cn/large/e6c9d24ely1h297mg34txj20xc0c875r.jpg)
    >
    >*   每层仅增加一个n维（input维度）权重向量，且每层都保留input向量。
    >*   Cross相比Wide部分基础上进行特征的自动化交叉，币面更多基于业务理解的人工特征组合。
    >*   Deep部分比Cross部分表达能力更强，更强非线性学习能力。

### 3.6.4 Wide&Deep模型影响力

DeepFM，NFM等模型可以看做Wide&Deep模型延伸。

Wide&Deep特点：

*   抓住业务问题的本质特点，融合传统模型记忆能力和深度学习模型泛化能力的优势。
*   模型结构容易在工程上实现，训练和上线。



































